!function(n){"use strict";var e=/@([A-Za-z]+[_A-Za-z0-9]+)/gi;n.jMentions=function(t,o){function a(e,o){var a=n('<div class="'+o+'"></div>');e.length&&(n.jMentions.elm=t,e.forEach(function(e){var t=e[n.jMentions.elm.data("options").value],o=e[n.jMentions.elm.data("options").label],i=e[n.jMentions.elm.data("options").avatar];a.append("<div onclick=\"$(this).jMentions.addMention('"+t+'\')" data-mention="'+t+'"><img src="'+i+'" >'+o+"</div>")}),n("."+n.jMentions.elm.data("options").dropdownClass).remove(),n(t).after(a))}var i=n.extend({dropdownClass:"jmentions-dropdown",value:"value",label:"label",avatar:"avatar",source:function(){return{}}},o);n(t).data("options",i);var s;n.jMentions.getResults=function(e){var o,a=[];if(o=e?n(e).find("span[value]"):n(t).find("span[value]"))for(var i=0;i<o.length;i++)a.indexOf(n(o[i]).attr("value"))==-1&&a.push(n(o[i]).attr("value"));return a},n(t).keyup(function(t){n("."+n(this).data("options").dropdownClass).remove();var o=n(this).text().match(e);if(o){var i=o[0].length,l=n(this).data("options").dropdownClass,r=o[0].slice(1,i);if(n(this).data("options").source(r).promise)n(this).data("options").source(r).promise().done(function(e){a(e,l),n.jMentions.mentions=e});else{var d=n(this).data("options").source(r);a(d,l),n.jMentions.mentions=d}}else n.jMentions.mentions=[];var m=window.getSelection().getRangeAt(0);s&&n(this).html().length<s&&"SPAN"==m.commonAncestorContainer.parentNode.tagName&&n(this)[0].removeChild(m.commonAncestorContainer.parentNode),s=n(this).html().length})},n.fn.jMentions=function(e){return n.jMentions(this,e)},n.fn.jMentions.addMention=function(t){n.jMentions.mentions.forEach(function(e){t==e[n.jMentions.elm.data("options").value]&&(t=e)});var o=n(n.jMentions.elm),a='&#8203;<span value="'+t[n.jMentions.elm.data("options").value]+'" disabled>'+t[n.jMentions.elm.data("options").label]+"</span>&#8203;&nbsp;";o.html(o.html().replace(e,a)),o.click();var i=n("<span />").appendTo(o),s=i.get(0),l=null,r=null;l=document.createRange(),l.selectNode(s),r=window.getSelection(),r.removeAllRanges(),r.addRange(l),i.remove(),n.jMentions.mentions=[],n("."+n.jMentions.elm.data("options").dropdownClass).remove()}}(jQuery);