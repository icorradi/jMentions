!function(n){"use strict";var e=/@([A-Za-z]+[_A-Za-z0-9]+)/gi;n.jMentions=function(o,t){function i(){var e=n('<div class="'+n.jMentions.options.dropdownClass+'"></div>');n.jMentions.mentions.length&&(n.jMentions.mentions.forEach(function(o){e.append("<div onclick=\"$(this).jMentions.addMention('"+o[n.jMentions.options.value]+'\')" data-mention="'+o[n.jMentions.options.value]+'">'+o[n.jMentions.options.label]+"</div>")}),n(o).after(e))}n.jMentions={options:n.extend({dropdownClass:"jmentions-dropdown",value:"value",label:"label",source:function(){return{}}},t),elm:o};var s;n.jMentions.getResults=function(e){var t=[];if(e)var i=n(e).find("span[value]");else var i=n(o).find("span[value]");if(i)for(var s=0;s<i.length;s++)-1==t.indexOf(n(i[s]).attr("value"))&&t.push(n(i[s]).attr("value"));return t},n(o).keyup(function(t){n("."+n.jMentions.options.dropdownClass).remove();var a=n(o).text().match(e);if(a){var l=a[0].length,r=a[0].slice(1,l);n.jMentions.options.source(r).promise?n.jMentions.options.source(r).promise().done(function(e){n.jMentions.mentions=e,i()}):(n.jMentions.mentions=n.jMentions.options.source(r),i())}else n.jMentions.mentions=[];var d=window.getSelection().getRangeAt(0);if(s&&n(o).html().length<s){var d=window.getSelection().getRangeAt(0);"SPAN"==d.commonAncestorContainer.parentNode.tagName&&n(o)[0].removeChild(d.commonAncestorContainer.parentNode)}s=n(o).html().length})},n.fn.jMentions=function(e){return n.jMentions(this,e)},n.fn.jMentions.addMention=function(o){n.jMentions.mentions.forEach(function(e){o==e[n.jMentions.options.value]&&(o=e)});var t=n(n.jMentions.elm),i='&#8203;<span value="'+o[n.jMentions.options.value]+'" disabled>'+o[n.jMentions.options.label]+"</span>&#8203;&nbsp;";t.html(t.html().replace(e,i)),t.click();var s=n("<span />").appendTo(t),a=s.get(0),l=null,r=null;l=document.createRange(),l.selectNode(a),r=window.getSelection(),r.removeAllRanges(),r.addRange(l),s.remove(),n.jMentions.mentions=[],n("."+n.jMentions.options.dropdownClass).remove()}}(jQuery);